# ‚öôÔ∏è Lazy vs Eager Loading –≤ C\#

–í C# —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø–æ–¥—Ö–æ–¥ **"–æ—Ç–ª–æ–∂–µ–Ω–Ω–æ–π" (Lazy)** –∏–ª–∏ **"–∂–∞–¥–Ω–æ–π" (Eager)** –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –æ–±—ä–µ–∫—Ç–æ–≤ –∏–ª–∏ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö. –ü–æ–Ω–∏–º–∞–Ω–∏–µ —Ä–∞–∑–Ω–∏—Ü—ã –º–µ–∂–¥—É —ç—Ç–∏–º–∏ –ø–æ–¥—Ö–æ–¥–∞–º–∏ –æ—Å–æ–±–µ–Ω–Ω–æ –≤–∞–∂–Ω–æ –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å –±–æ–ª—å—à–∏–º–∏ –æ–±—ä—ë–º–∞–º–∏ –¥–∞–Ω–Ω—ã—Ö, Entity Framework, –∫–æ–ª–ª–µ–∫—Ü–∏—è–º–∏, —Ä–µ—Å—É—Ä—Å–æ–∑–∞—Ç—Ä–∞—Ç–Ω—ã–º–∏ –æ–ø–µ—Ä–∞—Ü–∏—è–º–∏ –∏ –º–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω–æ—Å—Ç—å—é.

---

## üü¢ –ß—Ç–æ —Ç–∞–∫–æ–µ Eager Loading?

**Eager Loading (–∂–∞–¥–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞)** ‚Äî —ç—Ç–æ –ø–æ–¥—Ö–æ–¥, –ø—Ä–∏ –∫–æ—Ç–æ—Ä–æ–º –æ–±—ä–µ–∫—Ç –∏ –≤—Å–µ –µ–≥–æ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É—é—Ç—Å—è **–Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ**, –≤ –º–æ–º–µ–Ω—Ç —Å–æ–∑–¥–∞–Ω–∏—è –∏–ª–∏ –æ–±—Ä–∞—â–µ–Ω–∏—è.

### üî∏ –ü—Ä–∏–º–µ—Ä

```csharp
public class DataService
{
    private readonly HeavyResource _resource = new HeavyResource(); // —Å—Ä–∞–∑—É —Å–æ–∑–¥–∞–µ—Ç—Å—è

    public void UseResource()
    {
        _resource.Execute();
    }
}
```

### ‚úÖ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

* –ü—Ä–æ—Å—Ç–æ—Ç–∞ –∫–æ–¥–∞: –≤—Å—ë –¥–æ—Å—Ç—É–ø–Ω–æ —Å—Ä–∞–∑—É.
* –ù–µ —Ç—Ä–µ–±—É–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –ø—Ä–æ–≤–µ—Ä–æ–∫ (null, —Å–æ—Å—Ç–æ—è–Ω–∏–µ).
* –ü–æ–ª–µ–∑–µ–Ω, –µ—Å–ª–∏ –æ–±—ä–µ–∫—Ç **—Ç–æ—á–Ω–æ –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è**.

### ‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏

* –ú–æ–∂–µ—Ç –ø–æ—Ç—Ä–µ–±–æ–≤–∞—Ç—å –º–Ω–æ–≥–æ –ø–∞–º—è—Ç–∏ –∏ —Ä–µ—Å—É—Ä—Å–æ–≤ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ.
* –ó–∞–º–µ–¥–ª—è–µ—Ç –∑–∞–ø—É—Å–∫ –ø—Ä–æ–≥—Ä–∞–º–º—ã.
* –ú–æ–∂–µ—Ç –∑–∞–≥—Ä—É–∑–∏—Ç—å –Ω–µ–Ω—É–∂–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ.

---

## üü° –ß—Ç–æ —Ç–∞–∫–æ–µ Lazy Loading?

**Lazy Loading (–æ—Ç–ª–æ–∂–µ–Ω–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞)** ‚Äî —ç—Ç–æ –ø–æ–¥—Ö–æ–¥, –ø—Ä–∏ –∫–æ—Ç–æ—Ä–æ–º –æ–±—ä–µ–∫—Ç **–Ω–µ —Å–æ–∑–¥–∞–µ—Ç—Å—è**, –ø–æ–∫–∞ –Ω–µ –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è –≤–ø–µ—Ä–≤—ã–µ. –í .NET –¥–ª—è —ç—Ç–æ–≥–æ –ø—Ä–µ–¥—É—Å–º–æ—Ç—Ä–µ–Ω —Ç–∏–ø `Lazy<T>`.

### üî∏ –ü—Ä–∏–º–µ—Ä —Å `Lazy<T>`

```csharp
public class DataService
{
    private readonly Lazy<HeavyResource> _resource = new(() => new HeavyResource());

    public void UseResource()
    {
        _resource.Value.Execute(); // —Å–æ–∑–¥–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –≤—ã–∑–æ–≤–µ
    }
}
```

### ‚úÖ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

* –≠–∫–æ–Ω–æ–º–∏—è –ø–∞–º—è—Ç–∏ –∏ —Ä–µ—Å—É—Ä—Å–æ–≤.
* –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.
* –ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –æ–±—ä–µ–∫—Ç–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥—É—Ç **–Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –ø–æ–Ω–∞–¥–æ–±–∏—Ç—å—Å—è**.

### ‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏

* –£—Å–ª–æ–∂–Ω–µ–Ω–∏–µ –ª–æ–≥–∏–∫–∏ (–æ—Å–æ–±–µ–Ω–Ω–æ –ø—Ä–∏ –º–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω–æ—Å—Ç–∏).
* –ó–∞–¥–µ—Ä–∂–∫–∞ –≤ –º–æ–º–µ–Ω—Ç –ø–µ—Ä–≤–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞.
* –í–æ–∑–º–æ–∂–Ω—ã –æ—à–∏–±–∫–∏, –µ—Å–ª–∏ –ª–µ–Ω–∏–≤—ã–π –æ–±—ä–µ–∫—Ç –Ω–µ –±—ã–ª –ø—Ä–æ–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ.

---

## üîç –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Lazy<T> –≤ C\#

`Lazy<T>` ‚Äî —ç—Ç–æ –æ–±—ë—Ä—Ç–∫–∞ –≤–æ–∫—Ä—É–≥ –∑–Ω–∞—á–µ–Ω–∏—è, –∫–æ—Ç–æ—Ä–æ–µ –±—É–¥–µ—Ç –≤—ã—á–∏—Å–ª–µ–Ω–æ **–µ–¥–∏–Ω–æ–∂–¥—ã** –∏ **—Ç–æ–ª—å–∫–æ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –¥–æ—Å—Ç—É–ø–µ**.

### –ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä—ã

```csharp
var lazy = new Lazy<MyObject>();               // —Ç—Ä–µ–±—É–µ—Ç MyObject –∏–º–µ—Ç—å –ø—É–±–ª–∏—á–Ω—ã–π –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä
var lazy = new Lazy<MyObject>(() => new MyObject("param")); // –∫–∞—Å—Ç–æ–º–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
```

### –ü–æ—Ç–æ–∫–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é `Lazy<T>` –ø–æ—Ç–æ–∫–æ–±–µ–∑–æ–ø–∞—Å–µ–Ω (—Ä–µ–∂–∏–º `LazyThreadSafetyMode.ExecutionAndPublication`).

```csharp
var lazy = new Lazy<MyObject>(() => new MyObject(), true);
```

–í—ã –º–æ–∂–µ—Ç–µ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–æ–≤–µ–¥–µ–Ω–∏–µ —Å –ø–æ–º–æ—â—å—é `LazyThreadSafetyMode`:

* `None`: –±–µ–∑ –ø–æ—Ç–æ–∫–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏.
* `PublicationOnly`: —Å–æ–∑–¥–∞—ë—Ç –æ–±—ä–µ–∫—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑, –Ω–æ –ø—É–±–ª–∏–∫—É–µ—Ç —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω.
* `ExecutionAndPublication`: –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø–æ—Ç–æ–∫–æ–±–µ–∑–æ–ø–∞—Å–µ–Ω.

---

## üß† –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Lazy Loading

| –°—Ü–µ–Ω–∞—Ä–∏–π                             | –ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è Lazy? |
| ------------------------------------ | ------------------ |
| –ó–∞–≥—Ä—É–∑–∫–∞ –±–æ–ª—å—à–∏—Ö –∫–æ–ª–ª–µ–∫—Ü–∏–π           | ‚úÖ –î–∞               |
| –ò–Ω—Å—Ç–∞–Ω—Ü–∏–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç—è–∂—ë–ª—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤    | ‚úÖ –î–∞               |
| –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–µ—Ä–≤–∏—Å–æ–≤ –ø–æ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—é | ‚úÖ –î–∞               |
| –ß–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –æ–±—ä–µ–∫—Ç—ã           | ‚ùå –õ—É—á—à–µ Eager      |
| –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∏–ª–∏ DI                  | ‚ö†Ô∏è –ü–æ —Å–∏—Ç—É–∞—Ü–∏–∏     |

---

## üèó –ü—Ä–∏–º–µ—Ä: –õ–µ–Ω–∏–≤–æ–µ —Å–≤–æ–π—Å—Ç–≤–æ

```csharp
public class UserProfile
{
    private readonly Lazy<List<string>> _permissions = new(() => LoadPermissions());

    public List<string> Permissions => _permissions.Value;

    private static List<string> LoadPermissions()
    {
        // –î–æ–ª–≥–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è
        Thread.Sleep(1000);
        return new List<string> { "Read", "Write", "Delete" };
    }
}
```

---

## üóÇ Eager vs Lazy –≤ Entity Framework

### Eager Loading

```csharp
var orders = context.Users
    .Include(u => u.Orders)
    .ToList();
```

* –ó–∞–≥—Ä—É–∑–∏—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π **–∏** –∏—Ö –∑–∞–∫–∞–∑—ã –≤ **–æ–¥–Ω–æ–º** SQL-–∑–∞–ø—Ä–æ—Å–µ.
* –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `Include(...)`.

### Lazy Loading (—Ç—Ä–µ–±—É–µ—Ç –ø—Ä–æ–∫—Å–∏ –∏ –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã—Ö —Å–≤–æ–π—Å—Ç–≤)

```csharp
public class User
{
    public virtual ICollection<Order> Orders { get; set; }
}

var user = context.Users.First();
var orders = user.Orders; // –∑–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –∑–¥–µ—Å—å, –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –¥–æ—Å—Ç—É–ø–µ
```

* –ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç **–ø–æ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—é**, –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –æ–±—Ä–∞—â–µ–Ω–∏–∏ –∫ –Ω–∞–≤–∏–≥–∞—Ü–∏–æ–Ω–Ω–æ–º—É —Å–≤–æ–π—Å—Ç–≤—É.
* –¢—Ä–µ–±—É–µ—Ç –ø–æ–¥–¥–µ—Ä–∂–∫–∏ `virtual`, –ø—Ä–æ–∫—Å–∏ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ `DbContext`.

---

## üîÑ –°—Ä–∞–≤–Ω–∏—Ç–µ–ª—å–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞

| –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞       | Eager Loading       | Lazy Loading                 |
| -------------------- | ------------------- | ---------------------------- |
| –í—Ä–µ–º—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏  | –ù–µ–º–µ–¥–ª–µ–Ω–Ω–æ          | –ü—Ä–∏ –ø–µ—Ä–≤–æ–º –¥–æ—Å—Ç—É–ø–µ           |
| –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏ | –í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è | –¢–æ–ª—å–∫–æ –µ—Å–ª–∏ –æ–±—ä–µ–∫—Ç –Ω—É–∂–µ–Ω     |
| –°–∫–æ—Ä–æ—Å—Ç—å —Å—Ç–∞—Ä—Ç–∞      | –ú–µ–¥–ª–µ–Ω–Ω–µ–µ           | –ë—ã—Å—Ç—Ä–µ–µ                      |
| –°–ª–æ–∂–Ω–æ—Å—Ç—å            | –ù–∏–∂–µ                | –í—ã—à–µ                         |
| –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –≤ EF       | `Include(...)`      | `virtual`, –ø—Ä–æ–∫—Å–∏, –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ |

---

## üí° –ü–æ–ª–µ–∑–Ω—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã

* **Lazy Singleton**:

```csharp
public class Singleton
{
    private static readonly Lazy<Singleton> _instance = new(() => new Singleton());

    public static Singleton Instance => _instance.Value;

    private Singleton() { }
}
```

* **Dependency Injection + Lazy**:

```csharp
public class MyService
{
    private readonly Lazy<INotificationService> _notification;

    public MyService(Lazy<INotificationService> notification)
    {
        _notification = notification;
    }

    public void Notify() => _notification.Value.Send();
}
```

---

## üìå –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

* **Eager**, –µ—Å–ª–∏:

  * –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç—å **–≤—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è**.
  * –ù—É–∂–Ω–æ –±—ã—Å—Ç—Ä–æ –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –±–µ–∑ –∑–∞–¥–µ—Ä–∂–µ–∫.
* **Lazy**, –µ—Å–ª–∏:

  * –û–±—ä–µ–∫—Ç –∑–∞—Ç—Ä–∞—Ç–µ–Ω –ø–æ —Ä–µ—Å—É—Ä—Å–∞–º.
  * –ï—Å—Ç—å –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å, —á—Ç–æ –æ–Ω **–Ω–µ –ø–æ–Ω–∞–¥–æ–±–∏—Ç—Å—è**.
  * –ù–µ–æ–±—Ö–æ–¥–∏–º–æ **–æ—Ç–ª–æ–∂–∏—Ç—å** –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é –¥–æ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –º–æ–º–µ–Ω—Ç–∞.

